---
title: "Stimulus Checks and Consumer Spending"
author: "Aaron Davis, Navya Sonti, Rujula Nadipi, Swapnil Sethi, and Ujas Shah"
date: "9/19/2021"
output: powerpoint_presentation
---

# Do stimulus checks help the economy?
(using high customer spending as a proxy for economic health)

# Why Should **YOU** Care How Healthy the US Economy Is?

## Healthy Economy --> More Jobs 

## &

## Healthy Economy --> Better-Paying Jobs

# Data Source & Associated Paper

## **https://github.com/OpportunityInsights/EconomicTracker**

## "The Economic Impacts of COVID-19: Evidence from a New Public Database Built Using Private Sector Data", by Raj Chetty, John Friedman, Nathaniel Hendren, Michael Stepner, and the Opportunity Insights Team. November 2020. Available at: https://opportunityinsights.org/wp-content/uploads/2020/05/tracker_paper.pdf


```{r setup, include=FALSE, tidy=TRUE}
library(tidyverse)
library(lubridate)
```

```{r get_data, cache = TRUE, message = FALSE, include=FALSE}

options(width = 30)

covid_daily_df <- read_csv("https://raw.githubusercontent.com/OpportunityInsights/EconomicTracker/main/data/COVID%20-%20State%20-%20Daily.csv")

move_daily_df <- read_csv("https://raw.githubusercontent.com/OpportunityInsights/EconomicTracker/main/data/Google%20Mobility%20-%20State%20-%20Daily.csv")

affinity_daily_df <- read_csv("https://raw.githubusercontent.com/OpportunityInsights/EconomicTracker/main/data/Affinity%20-%20State%20-%20Daily.csv")

job_listings_weekly_df <- read_csv("https://raw.githubusercontent.com/OpportunityInsights/EconomicTracker/main/data/Burning%20Glass%20-%20State%20-%20Weekly.csv")

employment_daily_df <- read_csv("https://raw.githubusercontent.com/OpportunityInsights/EconomicTracker/main/data/Employment%20-%20State%20-%20Daily.csv")

ui_claims_weekly_df <- read_csv("https://raw.githubusercontent.com/OpportunityInsights/EconomicTracker/main/data/UI%20Claims%20-%20State%20-%20Weekly.csv")

state_id <- read_csv("https://raw.githubusercontent.com/OpportunityInsights/EconomicTracker/main/data/GeoIDs%20-%20State.csv")

# stimulus <- read_csv("")
```

```{r join_tibbles, include=FALSE}
df <- left_join(affinity_daily_df, move_daily_df, by = c("year", "month", "day", "statefips"))

df <- left_join(df, covid_daily_df, by = c("year", "month", "day", "statefips"))

df <- left_join(df, employment_daily_df, by = c("year", "month", "day", "statefips"))

df <- full_join(df, job_listings_weekly_df, by = c("year", "month", "day" = "day_endofweek", "statefips"))

df <- full_join(df, ui_claims_weekly_df, by = c("year", "month", "day" = "day_endofweek", "statefips"))

df <- left_join(df, state_id, by = c("statefips"))
```

```{r clean_dates, include=FALSE}
# https://tidyr.tidyverse.org/reference/unite.html
df <- df %>% unite("date", day:month:year, remove = FALSE, sep = "-")

# https://lubridate.tidyverse.org/reference/ymd.html
df$date <- dmy(df$date)

df <- df %>% mutate(week = week(date))
```

```{r condense_data, warning = FALSE, include=FALSE}

df <- df %>%
  select(date, year, month, day, week, statename, stateabbrev, state_pop2019, initclaims_rate_regular, contclaims_rate_combined, bg_posts, emp, spend_all, gps_retail_and_recreation, gps_grocery_and_pharmacy, gps_parks, gps_transit_stations, gps_workplaces, gps_residential, gps_away_from_home, new_case_count, new_death_count, case_count, death_count) %>%
  mutate(
    spend_all = as.double(spend_all),
    gps_parks = as.double(gps_parks),
    new_case_count = as.double(new_case_count),
    new_death_count = as.double(new_death_count),
    case_count = as.double(case_count),
    death_count = as.double(death_count),
    gps_transit_stations = as.double(gps_transit_stations),
    emp = as.double(emp),
    contclaims_rate_combined = as.double(contclaims_rate_combined)
  )


glimpse(df)
```

# Replace **NA** values with **0**

```{r remove_na}
# https://stackoverflow.com/questions/45576805/how-to-replace-all-na-in-a-dataframe-using-tidyrreplace-na

df <- df %>% replace(is.na(.), 0)
df <- df %>% filter(spend_all != 0)
```

# Combine Weekly and Daily Data

```{r}
df_weekly <- df %>%
  group_by(year, week, stateabbrev) %>%
  summarize(spend_all = mean(spend_all), contclaims_rate_combined = mean(contclaims_rate_combined), bg_posts = mean(bg_posts), emp = mean(emp), gps_retail_and_recreation = mean(gps_retail_and_recreation), gps_grocery_and_pharmacy = mean(gps_grocery_and_pharmacy), gps_parks = mean(gps_parks), gps_transit_stations = mean(gps_transit_stations), gps_workplaces = mean(gps_workplaces), gps_residential = mean(gps_residential), gps_away_from_home = mean(gps_away_from_home), new_case_count = sum(new_case_count), new_death_count = sum(new_death_count), case_count = max(case_count), death_count = max(death_count), date = max(date))

df_weekly <- left_join(df_weekly, state_id, by = c("stateabbrev"))
```
```{r}

```

# Adding Stimulus Check Data

```{r add_stimulus_checks, warning = FALSE}

df_weekly <- df_weekly %>% mutate(
  first_check = (if (date < ymd("2020-04-15")) {
    0
  } else {
    1
  }),
  second_check = (if (date < ymd("2021-01-04")) {
    0
  } else {
    1
  }),
  third_check = (if (date < ymd("2021-03-18")) {
    0
  } else {
    1
  })
)
```

```{r, include=FALSE}
sum(sapply(df_weekly, is.infinite))
```

# Plotting spending over time for all states and categories

(The dates for the stimulus checks were approximated from [this article](https://en.as.com/en/2021/08/25/latest_news/1629920433_478504.html).) 

```{r plot_spend_smooth, cache = TRUE, echo=FALSE, warnings=FALSE, results="hide", fig.keep="all", message=FALSE}

#https://stackoverflow.com/questions/30810476/suppress-console-output-in-r-markdown-but-keep-plot

# https://stackoverflow.com/questions/38815996/r-adding-geom-vline-labels-to-geom-histogram-labels

ggplot(df_weekly, aes(x = date, y = spend_all)) +
  geom_smooth() +
  geom_vline(xintercept = as.Date("2020-04-12")) +
  geom_vline(xintercept = as.Date("2021-01-01")) +
  geom_vline(xintercept = as.Date("2021-03-01")) +
  geom_text(aes(x = as.Date("2020-05-28"), label = "1st Check"),
    color = "red", angle = 45, y = 0
  ) +
  geom_text(aes(x = as.Date("2020-11-05"), label = "2nd Check"),
    color = "dark green", angle = 45, y = -.1
  ) +
  geom_text(aes(x = as.Date("2021-04-25"), label = "3rd Check"),
    color = "blue",
    angle = 45, y = -.1
  ) +
  labs(
    title = "What We Wished Our Data Looked Like",
    subtitle = "Spending Over Time (Compared to Pre-Pandemic Baseline)"
  )
```

```{r plot_spend_all, cache = TRUE, echo=FALSE, warnings=FALSE, results="hide", fig.keep="all", message=FALSE}

# https://stackoverflow.com/questions/38815996/r-adding-geom-vline-labels-to-geom-histogram-labels

ggplot(df, aes(x = date, y = spend_all)) +
  geom_point() +
  geom_smooth() +
  geom_vline(xintercept = as.Date("2020-04-12")) +
  geom_vline(xintercept = as.Date("2021-01-01")) +
  geom_vline(xintercept = as.Date("2021-03-01")) +
  geom_text(aes(x = as.Date("2020-05-28"), label = "1st Check"), color = "red", angle = 45, y = 0) +
  geom_text(aes(x = as.Date("2020-11-05"), label = "2nd Check"), color = "dark green", angle = 45, y = -.1) +
  geom_text(aes(x = as.Date("2021-04-25"), label = "3rd Check"), color = "blue", angle = 45, y = -.1) +
  labs(title = "What Our Data Looks Like", subtitle = "Spending Over Time (Compared to Pre-Pandemic Baseline)")
```

```{r, echo=FALSE, warnings=FALSE, results="hide", fig.keep="all", message=FALSE}
ggplot(df, aes(x = gps_retail_and_recreation, y = spend_all, color = stateabbrev)) +
  geom_point()
```

# Training a Linear Model

```{r, echo=FALSE}
mod <- lm(spend_all ~ gps_retail_and_recreation + emp + first_check +
  second_check + third_check, data = df_weekly)
```

```{r, echo=FALSE}
summary(mod)
```


```{r, echo=FALSE, results="hide", fig.keep="all", message=FALSE}
ggplot(df_weekly, aes(x = date, y = spend_all)) +
  geom_point() +
  geom_smooth(method = "lm", size = 2)
```


# Summarize the Model

## It's really bad, to be blunt.

## Possible Better Models
- Neural Networks
- Decision Trees
- Time Series Models (LSTM, RNN, etc.)



# Some Possible Biases

- Movement data only comes from Google
- Effect of stimulus checks won't fade, because of the way we encoded the data.

# Conclusion

Stimulus checks seem to encourage consumer spending, unsurprisingly.  *Assuming* that high consumer spending attributes to a healthier economy, we can conclude that stimulus checks will encourage more new job openings that offer higher wages.


